!function(){var t=window,e=0;t.requestAnimationFrame=t.requestAnimationFrame||t.webkitRequestAnimationFrame,t.requestAnimationFrame||(t.requestAnimationFrame=function(t){var i=new Date().getTime(),s=Math.max(0,16-(i-e)),o=setTimeout(t,s);return e=i+s,o}),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(t){clearTimeout(t)})}(),function(t,e){"function"==typeof define&&define.amd?define("themeone-utils/utils",e):"object"==typeof module&&module.exports?module.exports=e():t.ThemeoneUtils=e()}(this,function(){"use strict";var t={},e=window.console;return t.error=function(t){void 0!==e&&e.error(t)},t.extend=function(t,e){if(t){if("object"!=typeof t)this.error("Custom options must be an object");else for(var i in e)e.hasOwnProperty(i)&&t.hasOwnProperty(i)&&(e[i]=t[i])}return e},t.prop=function(t){for(var e=this.createEl(),i=["","Webkit","Moz","ms","O"],s=0,o=i.length;s<o;s++){var n=i[s]?i[s]+t.charAt(0).toUpperCase()+t.slice(1):t;if(void 0!==e.style[n])return n}return""},t.cloneObject=function(t){var e={};for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},t.createEl=function(t,e){var i=document.createElement(t||"div");return e&&(i.className=e),i},t.camelize=function(t){return t.replace(/-([a-z])/g,function(t){return t[1].toUpperCase()})},t.handleEvents=function(t,e,i,s,o){"object"!=typeof this.event_handlers&&(this.event_handlers={}),this.event_handlers[s]||(this.event_handlers[s]=t[s].bind(t));var n=(o=void 0===o||!!o)?"addEventListener":"removeEventListener";i.forEach((function(t){e[n](t,this.event_handlers[s],!1)}).bind(this))},t.dispatchEvent=function(t,e,i,s,o){i+=e?"."+e:"";var n=s?[s].concat(o):[o];t.emitEvent(i,n)},t.throttle=function(t,e){var i=null,s=e;return function(){var e=arguments,o=Date.now();(!i||o-i>=s)&&(i=o,t.apply(this,e))}},t.modulo=function(t,e){return(t+e%t)%t},t.classReg=function(t){return RegExp("(^|\\s+)"+t+"(\\s+|$)")},t.hasClass=function(t,e){return!!t.className.match(this.classReg(e))},t.addClass=function(t,e){this.hasClass(t,e)||(t.className+=(t.className?" ":"")+e)},t.removeClass=function(t,e){this.hasClass(t,e)&&(t.className=t.className.replace(this.classReg(e)," ").replace(/\s+$/,""))},t.translate=function(t,e,i,s){var o=s?" scale("+s+","+s+")":"";t.style[this.browser.trans]=this.browser.gpu?"translate3d("+(e||0)+"px, "+(i||0)+"px, 0)"+o:"translate("+(e||0)+"px, "+(i||0)+"px)"+o},t.browser={trans:t.prop("transform"),gpu:!!t.prop("perspective")},t}),function(t,e){"function"==typeof define&&define.amd?define("themeone-event/event",e):"object"==typeof module&&module.exports?module.exports=e():t.ThemeoneEvent=e()}("undefined"!=typeof window?window:this,function(){"use strict";var t=function(){},e=t.prototype;return e.on=function(t,e){if(!t||!e)return null;var i=this._events=this._events||{},s=i[t]=i[t]||[];return -1===s.indexOf(e)&&s.push(e),this},e.off=function(t,e){var i=this._events&&this._events[t];if(!i||!i.length)return null;var s=i.indexOf(e);return -1!==s&&i.splice(s,1),this},e.emitEvent=function(t,e){var i=this._events&&this._events[t];if(!i||!i.length)return null;var s=0,o=i[s];e=e||[];for(var n=this._onceEvents&&this._onceEvents[t];o;){var r=n&&n[o];r&&(this.off(t,o),delete n[o]),o.apply(this,e),s+=r?0:1,o=i[s]}return this},t}),function(t,e){"function"==typeof define&&define.amd?define("themeone-animate/animate",["themeone-utils/utils","themeone-event/event"],e):"object"==typeof module&&module.exports?module.exports=e(require("themeone-utils"),require("themeone-event")):t.ThemeoneAnimate=e(t.ThemeoneUtils,t.ThemeoneEvent)}(this,function(t,e){"use strict";var i=function(t,e,i,s){this.element=t,this.defaults=e,this.forces={friction:i||.28,attraction:s||.028},this.resetAnimate()},s=i.prototype=Object.create(e.prototype);return s.updateDrag=function(t){this.move=!0,this.drag=t},s.releaseDrag=function(){this.move=!1},s.animateTo=function(t){this.attraction=t},s.startAnimate=function(){this.move=!0,this.settle=!1,this.restingFrames=0,this.RAF||this.animate()},s.stopAnimate=function(){this.move=!1,this.restingFrames=0,this.RAF&&(cancelAnimationFrame(this.RAF),this.RAF=!1),this.start=t.cloneObject(this.position),this.velocity={x:0,y:0,s:0}},s.resetAnimate=function(){this.stopAnimate(),this.settle=!0,this.drag=t.cloneObject(this.defaults),this.start=t.cloneObject(this.defaults),this.resting=t.cloneObject(this.defaults),this.position=t.cloneObject(this.defaults),this.attraction=t.cloneObject(this.defaults)},s.animate=function(){var e=(function(){if(void 0!==this.position){var i=t.cloneObject(this.position);this.applyDragForce(),this.applyAttractionForce(),t.dispatchEvent(this,"toanimate","render",this),this.integratePhysics(),this.getRestingPosition(),this.render(100),this.RAF=requestAnimationFrame(e),this.checkSettle(i)}}).bind(this);this.RAF=requestAnimationFrame(e)},s.integratePhysics=function(){for(var t in this.position)void 0!==this.position[t]&&(this.position[t]+=this.velocity[t],this.position[t]="s"===t?Math.max(.1,this.position[t]):this.position[t],this.velocity[t]*=this.getFrictionFactor())},s.applyDragForce=function(){if(this.move){for(var t in this.drag)if(void 0!==this.drag[t]){var e=this.drag[t]-this.position[t]-this.velocity[t];this.applyForce(t,e)}}},s.applyAttractionForce=function(){if(!this.move){for(var t in this.attraction)if(void 0!==this.attraction[t]){var e=(this.attraction[t]-this.position[t])*this.forces.attraction;this.applyForce(t,e)}}},s.getRestingPosition=function(){for(var t in this.position)void 0!==this.position[t]&&(this.resting[t]=this.position[t]+this.velocity[t]/(1-this.getFrictionFactor()))},s.applyForce=function(t,e){this.velocity[t]+=e},s.getFrictionFactor=function(){return 1-this.forces.friction},s.roundValues=function(t,e){for(var i in t)void 0!==t[i]&&(e="s"===i?100*e:e,t[i]=Math.round(t[i]*e)/e)},s.checkSettle=function(e){if(!this.move){var i=0;for(var s in this.position)if(void 0!==this.position[s]){var o="s"===s?1e4:100;Math.round(this.position[s]*o)===Math.round(e[s]*o)&&++i===Object.keys(this.position).length&&this.restingFrames++}}this.restingFrames>2&&(this.stopAnimate(),this.render(this.position.s>1?10:1),this.settle=!0,JSON.stringify(this.start)!==JSON.stringify(this.position)&&t.dispatchEvent(this,"toanimate","settle",this))},s.render=function(e){this.roundValues(this.position,e),t.translate(this.element,this.position.x,this.position.y,this.position.s)},i}),function(t,e){"function"==typeof define&&define.amd?define(["themeone-utils/utils","themeone-event/event","themeone-animate/animate"],e):"object"==typeof exports&&module.exports?module.exports=e(require("themeone-utils"),require("themeone-event"),require("themeone-animate")):t.ModuloBox=e(t.ThemeoneUtils,t.ThemeoneEvent,t.ThemeoneAnimate)}(this,function(t,e,i){"use strict";var s,o="1.5.0",n=0,r={},a="mobx"+(o+Math.random()).replace(/\D/g,""),h={uid:0},l={mediaSelector:".mobx",threshold:5,attraction:{slider:.055,slide:.018,thumbs:.016},friction:{slider:.62,slide:.18,thumbs:.22},rightToLeft:!1,loop:3,preload:1,unload:!1,timeToIdle:4e3,history:!1,mouseWheel:!0,contextMenu:!0,scrollBar:!0,fadeIfSettle:!1,controls:["close"],prevNext:!0,prevNextTouch:!1,counterMessage:"[index] / [total]",caption:!0,autoCaption:!1,captionSmallDevice:!0,thumbnails:!0,thumbnailsNav:"basic",thumbnailSizes:{1920:{width:110,height:80,gutter:10},1280:{width:90,height:65,gutter:10},680:{width:70,height:50,gutter:8},480:{width:60,height:44,gutter:5}},spacing:.1,smartResize:!0,overflow:!1,loadError:"Sorry, an error occured while loading the content...",noContent:"Sorry, no content was found!",prevNextKey:!0,scrollToNav:!1,scrollSensitivity:15,zoomTo:"auto",minZoom:1.2,maxZoom:4,doubleTapToZoom:!0,scrollToZoom:!1,pinchToZoom:!0,escapeToClose:!0,scrollToClose:!1,pinchToClose:!0,dragToClose:!0,tapToClose:!0,shareButtons:["facebook","googleplus","twitter","pinterest","linkedin","reddit"],shareText:"Share on",sharedUrl:"deeplink",slideShowInterval:4e3,slideShowAutoPlay:!1,slideShowAutoStop:!1,countTimer:!0,countTimerBg:"rgba(255,255,255,0.25)",countTimerColor:"rgba(255,255,255,0.75)",mediaelement:!1,videoRatio:16/9,videoMaxWidth:1180,videoAutoPlay:!1,videoThumbnail:!1},d=function(e){var i=document.querySelector(".mobx-holder");if(i&&i.GUID)return r[i.GUID];this.options=t.extend(e,l),this.setVar()},u=d.prototype=Object.create(e.prototype);return u.init=function(){!this.GUID&&(this.createDOM(),this.GUID=++n,this.DOM.holder.GUID=n,r[this.GUID]=this,this.setAnimation(),this.getGalleries(),this.openFromQuery())},u.setVar=function(){var t=window,e=document,i=navigator;this.pre="mobx",this.gesture={},this.buttons={},this.slider={},this.slides={},this.cells={},this.states={},this.pointers=[],this.expando=a,this.cache=h,this.dragEvents=this.detectPointerEvents(),this.browser={touchDevice:"ontouchstart"in t||i.maxTouchPoints>0||i.msMaxTouchPoints>0,pushState:"history"in t&&"pushState"in history,fullScreen:this.detectFullScreen(),mouseWheel:"onwheel"in e.createElement("div")?"wheel":void 0!==e.onmousewheel?"mousewheel":"DOMMouseScroll"},this.iframeVideo=this.iframeVideo(),this.socialMedia=this.socialMedia()},u.detectPointerEvents=function(){var t=navigator;return t.pointerEnabled?{start:["pointerdown"],move:["pointermove"],end:["pointerup","pointercancel"]}:t.msPointerEnabled?{start:["MSPointerDown"],move:["MSPointerMove"],end:["MSPointerUp","MSPointerCancel"]}:{start:["mousedown","touchstart"],move:["mousemove","touchmove"],end:["mouseup","mouseleave","touchend","touchcancel"]}},u.detectFullScreen=function(){for(var t=["fullscreenEnabled","webkitFullscreenEnabled","mozFullScreenEnabled","msFullscreenEnabled"],e=0,i=t.length;e<i;e++)if(document[t[e]])return{element:["fullscreenElement","webkitFullscreenElement","mozFullScreenElement","msFullscreenElement"][e],request:["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"][e],change:["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"][e],exit:["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"][e]};var s=this.options.controls,o=s.indexOf("fullScreen");return o>-1&&s.splice(o,1),null},u.iframeVideo=function(){return{youtube:{reg:/(?:www\.)?youtu\.?be(?:\.com)?\/?.*?(?:watch|embed)?(?:.*v=|v\/|watch%3Fv%3D|\/)([\w\-_]+)&?/i,url:"https://www.youtube.com/embed/[ID]?enablejsapi=1&rel=0&autoplay=1",share:"https://www.youtube.com/watch?v=[ID]",poster:"https://img.youtube.com/vi/[ID]/maxresdefault.jpg",thumb:"https://img.youtube.com/vi/[ID]/default.jpg",play:{event:"command",func:"playVideo"},pause:{event:"command",func:"pauseVideo"}},vimeo:{reg:/(?:www\.|player\.)?vimeo.com\/(?:channels\/(?:\w+\/)?|groups\/(?:[^\/]*)\/videos\/|album\/(?:\d+)\/video\/|video\/)?(\d+)(?:[a-zA-Z0-9_\-]+)?/i,url:"https://player.vimeo.com/video/[ID]?autoplay=1&api=1",share:"https://vimeo.com/[ID]",poster:"https://vimeo.com/api/v2/video/[ID].json",play:{event:"command",method:"play"},pause:{event:"command",method:"pause"}},dailymotion:{reg:/(?:www\.)?(?:dailymotion\.com(?:\/embed)(?:\/video|\/hub)|dai\.ly)\/([0-9a-z]+)(?:[\-_0-9a-zA-Z]+#video=(?:[a-zA-Z0-9_\-]+))?/i,url:"https://dailymotion.com/embed/video/[ID]?autoplay=1&api=postMessage",share:"https://www.dailymotion.com/video/[ID]",poster:"https://www.dailymotion.com/thumbnail/video/[ID]",thumb:"https://www.dailymotion.com/thumbnail/video/[ID]",play:"play",pause:"pause"},wistia:{reg:/(?:www\.)?(?:wistia\.(?:com|net)|wi\.st)\/(?:(?:m|medias|projects)|embed\/(?:iframe|playlists))\/([a-zA-Z0-9_\-]+)/i,url:"https://fast.wistia.net/embed/iframe/[ID]?version=3&enablejsapi=1&html5=1&autoplay=1",share:"https://fast.wistia.net/embed/iframe/[ID]",poster:"https://fast.wistia.com/oembed?url=https://home.wistia.com/medias/[ID].json",play:{event:"cmd",method:"play"},pause:{event:"cmd",method:"pause"}}}},u.socialMedia=function(){return{facebook:"https://www.facebook.com/sharer/sharer.php?u=[url]",googleplus:"https://plus.google.com/share?url=[url]",twitter:"https://twitter.com/intent/tweet?text=[text]&url=[url]",pinterest:"https://www.pinterest.com/pin/create/button/?url=[url]&media=[image]&description=[text]",linkedin:"https://www.linkedin.com/shareArticle?url=[url]&mini=true&title=[text]",reddit:"https://www.reddit.com/submit?url=[url]&title=[text]",stumbleupon:"https://www.stumbleupon.com/badge?url=[url]&title=[text]",tumblr:"https://www.tumblr.com/share?v=3&u=[url]&t=[text]",blogger:"https://www.blogger.com/blog_this.pyra?t&u=[url]&n=[text]",buffer:"https://bufferapp.com/add?url=[url]title=[text]",digg:"https://digg.com/submit?url=[url]&title=[text]",evernote:"https://www.evernote.com/clip.action?url=[url]&title=[text]"}},u.createDOM=function(){this.DOM={};for(var e=["holder","overlay","slider","item","item-inner","ui","top-bar","bottom-bar","share-tooltip","counter","caption","caption-inner","thumbs-holder","thumbs-inner"],i=0;i<e.length;i++)this.DOM[t.camelize(e[i])]=t.createEl("div",this.pre+"-"+e[i]);this.appendDOM(this.DOM)},u.appendDOM=function(e){var i=this.options;e.holder.appendChild(e.overlay),e.holder.appendChild(e.slider),e.holder.appendChild(e.ui);for(var s=0;s<5;s++){var n=e.item.cloneNode(!0);n.appendChild(e.itemInner.cloneNode(!0)),e.slider.appendChild(n),this.slides[s]=n}this.slides.length=e.slider.children.length,this.createUI(e,i),e.holder.setAttribute("tabindex",-1),e.holder.setAttribute("aria-hidden",!0),this.DOM.comment=document.createComment(" ModuloBox (v"+o+") by Themeone "),document.body.appendChild(this.DOM.comment),t.dispatchEvent(this,"modulobox","beforeAppendDOM",e),document.body.appendChild(e.holder),e.topBar.height=e.topBar.clientHeight},u.createUI=function(e,i){var s=i.controls.indexOf("share");if(s>-1){for(var o=i.shareButtons,n=o.length;n--;)this.socialMedia.hasOwnProperty(o[n])||o.splice(n,1);o.length?(e.ui.appendChild(e.shareTooltip),i.shareText&&(e.shareTooltip.appendChild(t.createEl("span")).textContent=i.shareText),this.createButtons(o,e.shareTooltip,"shareOn")):i.controls.splice(s,1)}if(i.controls.length||i.counterMessage){var r=i.controls.indexOf("play");if(e.ui.appendChild(e.topBar),i.counterMessage&&e.topBar.appendChild(e.counter),i.slideShowInterval<1&&r>-1&&i.controls.splice(r,1),i.countTimer&&r>-1){var a=this.DOM.timer=t.createEl("canvas",this.pre+"-timer");a.setAttribute("width",48),a.setAttribute("height",48),e.topBar.appendChild(a)}if(i.controls.length){var h=i.controls.slice();this.createButtons(h.reverse(),e.topBar)}}(i.caption||i.thumbnails)&&(e.ui.appendChild(e.bottomBar),i.caption&&e.bottomBar.appendChild(e.caption).appendChild(e.captionInner),i.thumbnails&&e.bottomBar.appendChild(e.thumbsHolder).appendChild(e.thumbsInner)),i.prevNext&&this.createButtons(["prev","next"],e.ui)},u.createButtons=function(e,i,s){for(var o=e.length,n=0;n<o;n++){var r=e[n];this.buttons[r]=t.createEl("BUTTON",this.pre+"-"+r.toLowerCase()),i.appendChild(this.buttons[r]),(r&&"function"==typeof this[r]||s)&&(this.buttons[r].event=s||r,this.buttons[r].action=r,"shareOn"===s&&this.buttons[r].setAttribute("title",r.charAt(0).toUpperCase()+r.slice(1)))}},u.getGalleries=function(){this.galleries={};var e=this.options.mediaSelector,i="";if(!e)return!1;try{i=document.querySelectorAll(e)}catch(s){t.error('Your current mediaSelector is not a valid selector: "'+e+'"')}for(var o=0,n=i.length;o<n;o++){var r=i[o],a={};if(a.src="A"===r.tagName?r.getAttribute("href"):null,a.src="IMG"===r.tagName?r.currentSrc||r.src:a.src,a.src=r.getAttribute("data-src")||a.src,a.src&&(this.getMediaAtts(r,a),this.setMediaType(a),a.type)){this.getMediaThumb(r,a),this.getVideoThumb(a),this.getMediaCaption(r,a),this.setMediaCaption(a);var h=this.setGalleryName(r);this.setGalleryFeatures(h,a),a.index=h.length,h.push(a),this.setMediaEvent(r,h.name,a.index)}}t.dispatchEvent(this,"modulobox","updateGalleries",this.galleries)},u.addMedia=function(e,i){if(!i||"object"!=typeof i)return t.error("No media was found to addMedia() in a gallery"),!1;e=""===e?1:e;var s=this.galleries[e];(s=s||(this.galleries[e]=[])).name=e;for(var o=i.length,n=0;n<o;n++){var r=t.cloneObject(i[n]);r.src&&(this.setMediaType(r),this.getVideoThumb(r),this.setMediaCaption(r),this.setGalleryFeatures(s,r),r.index=s.length,s.push(r))}},u.setMediaType=function(t){if(!(["image","video","iframe","HTML"].indexOf(t.type)>-1)){t.type=null;var e=t.src?t.src:null,i=(e.split(/[?#]/)[0]||e).substr((~-e.lastIndexOf(".")>>>0)+2);if(/(jpg|jpeg|png|bmp|gif|tif|tiff|jfi|jfif|exif|svg)/i.test(i)||["external.xx.fbcdn","drscdn.500px.org"].indexOf(e)>-1)t.type="image",t.src=this.getSrc(e);else if(/(mp4|webm|ogv)/i.test(i))t.type="video",t.format="html5";else{var s=this.iframeVideo;for(var o in s)if(s.hasOwnProperty(o)){var n=e.match(s[o].reg);if(n&&n[1]){var r=s[o];t.type="video",t.format=o,t.share=r.share.replace("[ID]",n[1]),t.src=r.url.replace("[ID]",n[1]),t.pause=r.pause,t.play=r.play,this.options.videoThumbnail&&(t.poster=!t.poster&&r.poster?r.poster.replace("[ID]",n[1]):t.poster,t.thumb=!t.thumb&&r.poster?r.poster.replace("[ID]",n[1]):t.thumb);break}}}}},u.getSrc=function(t){var e=(t||"").split(/,/),i=e.length,s=0;if(i<=1)return t;for(var o=0;o<i;o++){var n=e[o].replace(/\s+/g," ").trim().split(/ /),r=parseFloat(n[1])||0;("w"===(n[1]?n[1].slice(-1):null)&&screen.width>=r&&r>s||!r||0===o)&&(s=r,t=n[0])}return t},u.getMediaAtts=function(t,e){var i=this.options.autoCaption,s=this.getAttr(t),o=t.firstElementChild;o="IMG"!==t.tagName&&o&&"IMG"===o.tagName?o:t,e.type=e.type?e.type:s.type||t.getAttribute("data-type"),e.title=s.title||t.getAttribute("data-title")||(i?o.title:null),e.desc=s.desc||t.getAttribute("data-desc")||(i?o.alt:null),e.thumb=s.thumb||t.getAttribute("data-thumb"),e.poster=this.getSrc(s.poster||t.getAttribute("data-poster")),e.width=s.width||t.getAttribute("data-width"),e.height=s.height||t.getAttribute("data-height"),e.title===e.desc&&(e.desc=null)},u.getMediaThumb=function(t,e){var i=t.getElementsByTagName("img");!e.thumb&&i[0]&&(e.thumb=i[0].src)},u.getVideoThumb=function(t){if(this.options.videoThumbnail&&"video"===t.type&&"html5"!==t.format){var e=t.poster&&t.poster.indexOf(".json")>-1,i=t.thumb&&t.thumb.indexOf(".json")>-1;if(e||i){var s=e?t.poster:t.thumb,o=new XMLHttpRequest;o.onload=(function(e){var s=e.target.responseText;if((s=(s=JSON.parse(s)).hasOwnProperty(0)?s[0]:s)&&(t.poster=s.thumbnail_large||s.thumbnail_url,t.dom&&(t.dom.style.backgroundImage='url("'+t.poster+'")'),i)){var o=s.thumbnail_small||s.thumbnail_url;"object"==typeof t.thumb?t.thumb.style.backgroundImage='url("'+o+'")':t.thumb=o}}).bind(this),o.open("GET",encodeURI(s),!0),setTimeout(function(){o.send()},0)}}},u.getMediaCaption=function(t,e){var i=t.nextElementSibling;if(i&&"FIGCAPTION"===i.tagName){var s=i.innerHTML;e.title?e.desc||(e.desc=s):e.title=s}},u.setMediaCaption=function(t){t.title=t.title?'<div class="'+this.pre+'-title">'+t.title.trim()+"</div>":"",t.desc=t.desc?'<div class="'+this.pre+'-desc">'+t.desc.trim()+"</div>":"",t.caption=t.title+t.desc},u.getGalleryName=function(t){for(var e=t,i=0;e&&i<2;){if((e=e.parentNode)&&"FIGURE"===e.tagName&&e.parentNode)return e.parentNode.getAttribute("id");i++}},u.setGalleryName=function(t){var e=this.getAttr(t).rel||t.getAttribute("data-rel");e=(e=e||this.getGalleryName(t))||Object.keys(this.galleries).length+1;var i=this.galleries[e];return(i=i||(this.galleries[e]=[])).name=e,i},u.setGalleryFeatures=function(t,e){t.zoom||"image"!==e.type||(t.zoom=!0),t.download||"image"!==e.type&&"html5"!==e.format||(t.download=!0)},u.setMediaEvent=function(t,e,i){t.mobxListener&&t.removeEventListener("click",t.mobxListener,!1),t.mobxListener=this.open.bind(this,e,i),t.addEventListener("click",t.mobxListener,!1)},u.open=function(e,i,s){return s&&(s.preventDefault(),s.stopPropagation()),!!this.GUID&&(this.galleries.hasOwnProperty(e)?this.galleries[e].length?this.galleries[e][i]?void(t.dispatchEvent(this,"modulobox","beforeOpen",e,i),this.slides.index=i,this.gallery=this.galleries[e],this.gallery.name=e,this.gallery.index=i,this.gallery.loaded=!1,this.removeContent(),this.wrapAround(),this.hideScrollBar(),this.setSlider(),this.setThumbs(),this.setCaption(),this.setMedia(this.options.preload),this.updateMediaInfo(),this.replaceState(),this.setControls(),this.bindEvents(!0),this.show(),this.options.videoAutoPlay&&this.appendVideo(),this.options.slideShowAutoPlay&&this.options.controls.indexOf("play")>-1&&(!this.options.videoAutoPlay||"video"!==this.galleries[e][i].type)&&this.startSlideShow(),this.states.zoom=!1,this.states.open=!0):(t.error("Sorry, no media was found for the current media index: "+i),!1):(t.error("Sorry, no media was found for the current gallery."),!1):(t.error('This gallery name : "'+e+'", does not exist!'),!1))},u.openFromQuery=function(){var t=this.getQueryString(window.location.search);t.hasOwnProperty("guid")&&t.hasOwnProperty("mid")&&!1===this.open(decodeURIComponent(t.guid),decodeURIComponent(t.mid)-1)&&this.replaceState(!0)},u.show=function(){var e=this.DOM.holder,i=this.options.rightToLeft?"add":"remove";e.setAttribute("aria-hidden",!1),t.removeClass(e,this.pre+"-idle"),t.removeClass(e,this.pre+"-panzoom"),t.removeClass(e,this.pre+"-will-close"),t[i+"Class"](e,this.pre+"-rtl"),t.addClass(e,this.pre+"-open")},u.close=function(e){e&&e.preventDefault();var i=this.DOM.holder,s=this.gallery,o=s?s.index:"undefined",n=s?s.name:"undefined";t.dispatchEvent(this,"modulobox","beforeClose",n,o),this.states.fullScreen&&(this.exitFullScreen(),t.removeClass(i,this.pre+"-fullscreen")),this.share(),this.stopSlideShow(),this.pauseVideo(),this.bindEvents(!1),this.replaceState(!0),this.hideScrollBar(),i.setAttribute("aria-hidden",!0),t.removeClass(i,this.pre+"-open"),this.states.open=!1},u.setControls=function(){var t=this.gallery,e=this.options,i=this.buttons;this.DOM.counter&&(this.DOM.counter.style.display=t.initialLength>1?"":"none"),e.controls.indexOf("play")>-1&&(i.play.style.display=t.initialLength>1?"":"none"),e.controls.indexOf("zoom")>-1&&(i.zoom.style.display=t.zoom?"":"none"),e.controls.indexOf("download")>-1&&(i.download.style.display=t.download?"":"none"),this.setPrevNextButtons()},u.setPrevNextButtons=function(){if(this.options.prevNext){var t=this.slider.width<680&&this.browser.touchDevice&&!this.options.prevNextTouch;this.buttons.prev.style.display=this.buttons.next.style.display=this.gallery.length>1&&!t?"":"none"}},u.setCaption=function(){this.states.caption=!(!this.options.captionSmallDevice&&(this.slider.width<=480||this.slider.height<=480)),this.DOM.caption.style.display=this.states.caption?"":"none"},u.hideScrollBar=function(){if(!this.options.scrollBar){var t=this.states.open;document.body.style.overflow=document.documentElement.style.overflow="undefined"!==t&&t?"":"hidden"}},u.bindEvents=function(e){var i,s=window,o=this.options,n=this.DOM.holder,r=this.buttons;for(var a in r)if(r.hasOwnProperty(a)){var h="share"!==a?r[a]:s;t.handleEvents(this,h,["click","touchend"],r[a].event,e)}t.handleEvents(this,n,this.dragEvents.start,"touchStart",e),t.handleEvents(this,s,["keydown"],"keyDown",e),t.handleEvents(this,s,["resize","orientationchange"],"resize",e),t.handleEvents(this,n,["transitionend","webkitTransitionEnd","oTransitionEnd","otransitionend","MSTransitionEnd"],"opened"),t.handleEvents(this,n,["touchend"],"disableZoom",e),this.browser.fullScreen&&t.handleEvents(this,document,[this.browser.fullScreen.change],"toggleFullScreen",e),o.history&&t.handleEvents(this,s,["mouseout"],"mouseOut",e),o.timeToIdle>0&&t.handleEvents(this,n,["mousemove"],"mouseMove",e),o.contextMenu||t.handleEvents(this,n,["contextmenu"],"contextMenu",e),o.mouseWheel||this.disableScroll(e),o.scrollToZoom?i="scrollToZoom":o.scrollToNav?i="scrollToNav":o.scrollToClose&&(i="scrollToClose"),i&&t.handleEvents(this,n,[this.browser.mouseWheel],i,e)},u.opened=function(e){if("visibility"===e.propertyName&&e.target===this.DOM.holder){var i=this.gallery.name,s=this.gallery.index;this.states.open?t.dispatchEvent(this,"modulobox","afterOpen",i,s):(this.removeContent(),t.dispatchEvent(this,"modulobox","afterClose",i,s))}},u.mouseOut=function(t){var e=t||window.event,i=e.relatedTarget||e.toElement;i&&"HTML"!==i.nodeName||this.replaceState()},u.mouseMove=function(){var e=this.DOM.holder,i=this.pre+"-idle";clearTimeout(this.states.idle),this.states.idle=setTimeout((function(){t.hasClass(e,this.pre+"-open-tooltip")||t.addClass(e,i)}).bind(this),this.options.timeToIdle),t.removeClass(e,i)},u.contextMenu=function(t){var e=t.target,i=e.tagName,s=e.className;("IMG"===i||"VIDEO"===i||s.indexOf(this.pre+"-video")>-1||s.indexOf(this.pre+"-thumb-bg")>-1||s===this.pre+"-thumb")&&t.preventDefault()},u.disableScroll=function(t){var e=document,i=window,s=function(t){if(this.isEl(t)&&(t=t||i.event).preventDefault)return t.preventDefault(),t.returnValue=!1,!1};i.onwheel=i.ontouchmove=i.onmousewheel=e.onmousewheel=e.onmousewheel=t?s.bind(this):null},u.scrollToZoom=function(t){if(this.isEl(t)){var e=this.normalizeWheel(t);if(e&&e.deltaY){var i=this.getCell(),s=i.attraction.s||i.position.s;s=Math.min(this.options.maxZoom,Math.max(1,s-Math.abs(e.deltaY)/e.deltaY)),this.stopSlideShow(),this.zoomTo(t.clientX,t.clientY,Math.round(10*s)/10)}}},u.scrollToNav=function(t){if(this.isEl(t)){var e=this.normalizeWheel(t);e&&e.delta&&this[e.delta*this.isRTL()<0?"prev":"next"]()}},u.scrollToClose=function(t){this.isEl(t)&&(t.preventDefault(),this.close())},u.disableZoom=function(t){for(var e=t.target;e;){if(["VIDEO","INPUT","A"].indexOf(e.tagName)>-1)return;e=e.parentElement}t.preventDefault()},u.resize=function(e){this.DOM.topBar.height=this.DOM.topBar.clientHeight,this.share(),this.setSlider(),this.setThumbsPosition(),this.setCaption(),this.resizeMedia(),this.updateMediaInfo(),this.setPrevNextButtons(),this.states.zoom=!1,t.removeClass(this.DOM.holder,this.pre+"-panzoom"),t.dispatchEvent(this,"modulobox","resize",e)},u.resizeMedia=function(){for(var t=this.slides,e=0;e<t.length&&this.gallery;e++){var i=this.gallery[t[e].media];i&&(i.dom&&i.dom.loaded||i.dom&&["video","iframe","HTML"].indexOf(i.type)>-1)&&this.setMediaSize(i,t[e])}},u.isEl=function(t){var e=t.target.className;return(e="string"==typeof e?e:e.baseVal).indexOf(this.pre)>-1},u.isZoomable=function(){var t=this.getMedia(),e=!1;return"image"===t.type&&t.dom&&t.dom.size&&t.dom.size.scale>1&&(e=!0),this.DOM.holder.setAttribute("data-zoom",e),e},u.isDownloadable=function(){var t=this.getMedia(),e=!0;return"image"!==t.type&&"html5"!==t.format&&(e=!1),this.DOM.holder.setAttribute("data-download",e),e},u.isRTL=function(){return this.options.rightToLeft?-1:1},u.addAttr=function(t,e){var i;for(var s in void 0===t[this.expando]?(i=this.cache.uid++,t[this.expando]=i,this.cache[i]={}):i=t[this.expando],e)e.hasOwnProperty(s)&&(this.cache[i][s]=e[s])},u.getAttr=function(t){return this.cache[t[this.expando]]||{}},u.getThumbHeight=function(){var t=this.thumbs;return t.height>0&&t.width>0?t.height+2*Math.min(10,t.gutter):0},u.getMedia=function(){var t=this.gallery;return t?t[t.index]:null},u.getCell=function(){var e=this.slides,i=t.modulo(e.length,e.index);return this.cells[i]},u.removeContent=function(){for(var t=0;t<this.slides.length;t++){var e=this.slides[t];this.unloadMedia(e),this.removeMedia(e),e.index=e.media=null}this.removeMedia(this.DOM.thumbsHolder)},u.getQueryString=function(t){var e={};return t.substr(1).split("&").forEach(function(t){e[decodeURIComponent((t=t.split("="))[0])]=t.length>1?decodeURIComponent(t[1]):""}),e},u.setQueryString=function(t){var e,i=window.location.search,s=this.getQueryString(i);for(var o in i=decodeURI(i),t)if(t.hasOwnProperty(o)){var n=encodeURIComponent(t[o]);if(s.hasOwnProperty(o)){var r=s[o];i=n?i.replace(o+"="+r,o+"="+n):(i=i.replace("&"+o+"="+r,"")).replace(o+"="+r,"")}else i=n?i+(i?"&":"?")+o+"="+n:i.replace(o+"=","")}return encodeURI([location.protocol,"//",location.host,location.pathname].join("")+(i=i.substr(1)?i:i.substr(1)))},u.replaceState=function(e){if((this.options.history||e)&&this.browser.pushState&&!this.states.push){var i=window.history.state,s={guid:e?"":this.gallery.name,mid:e?"":t.modulo(this.gallery.initialLength,this.gallery.index)+1};if(!i||i.mid!==s.mid){var o=this.setQueryString(s);try{window.history.replaceState(s,"",o)}catch(n){this.options.history=!1,t.error("SecurityError: A history state object with origin 'null' cannot be created. Please run the script on a server.")}}}this.states.push=!1},u.normalizeWheel=function(t){var e,i,s,o=t||window.event,n=null;if(t.preventDefault(),"detail"in o&&(i=-1*o.detail),"wheelDelta"in o&&(i=-1*o.wheelDelta),"wheelDeltaY"in o&&(i=-1*o.wheelDeltaY),"wheelDeltaX"in o&&(e=-1*o.wheelDeltaX),"deltaY"in o&&(i=o.deltaY),"deltaX"in o&&(e=-1*o.deltaX),1===o.deltaMode?(e*=40,i*=40):2===o.deltaMode&&(e*=100,i*=100),Math.abs(s=Math.min(100,Math.max(-100,s=Math.abs(e)>Math.abs(i)?e:i)))<this.options.scrollSensitivity)return this.states.prevDelta=s,n;var r=+new Date;return(Math.abs(s)>Math.abs(this.states.prevDelta)||r-this.states.prevScroll>60)&&(n={deltaX:e,deltaY:i,delta:s}),this.states.prevDelta=s,this.states.prevScroll=r,n},u.share=function(e){if(!e||"VIDEO"!==e.target.tagName){var i=this.DOM.holder,s=this.pre+"-open-tooltip",o=e?e.target.className:null,n=t.hasClass(i,s)?"remove":"add";("remove"!==n||o===this.pre+"-share"&&e)&&o!==this.pre+"-share"||("add"===n&&this.setShareTooltip(),t[n+"Class"](i,s))}},u.shareOn=function(e){var i,s=e.target.action,o=this.gallery,n=this.getMedia(),r="image"===n.type?n.src:n.poster,a=this.socialMedia[s];if(a){"page"===this.options.sharedUrl?i=[location.protocol,"//",location.host,location.pathname].join(""):"deeplink"===this.options.sharedUrl||["iframe","HTML"].indexOf(n.type)>-1?i=this.setQueryString({guid:o.name,mid:o.index+1}):(i=n.src.replace(/\s/g,"").split(",")[0],"video"===n.type&&"html5"!==n.format&&(i=n.share));var h=t.createEl("a");h.href=r,r=h.href,h.href=i,i=h.href;var l=t.createEl("div");l.innerHTML=n.caption;var d=(l.textContent||l.innerText).replace(/\s+/g," ").trim()||"";if(a=a.replace("[url]",encodeURIComponent(i)).replace("[image]",encodeURIComponent(r)).replace("[text]",encodeURIComponent(d||document.title))){var u=Math.round(window.screenX+(window.outerWidth-626)/2),p=Math.round(window.screenY+(window.outerHeight-436)/2);window.open(a,this.pre+"_share","status=0,resizable=1,location=1,toolbar=0,width=626,height=436,top="+p+",left="+u)}}else t.error("This social share media does not exist");return!1},u.setShareTooltip=function(){if(this.options.controls.indexOf("share")>-1){var t="right",e=this.DOM.shareTooltip,i=e.clientWidth,s=this.buttons.share.getBoundingClientRect(),o=s.left-i+s.width/2+20;o<0&&(t="left",o=s.left+s.width/2-20),e.setAttribute("data-position",t),e.style.top=this.DOM.topBar.height+6+"px",e.style.left=o+"px"}},u.download=function(){if(!this.isDownloadable())return!1;var t=this.getMedia().src.replace(/\s/g,"").split(",")[0],e=document.createElement("a"),i=t.split("/");e.href=t,e.download=i.pop().split("?")[0],e.setAttribute("target","_blank"),document.body.appendChild(e),e.click(),document.body.removeChild(e)},u.fullScreen=function(){document[this.browser.fullScreen.element]?this.exitFullScreen():this.requestFullScreen()},u.toggleFullScreen=function(){var e=this.DOM.holder,i=document[this.browser.fullScreen.element];i?i===e&&(this.setShareTooltip(),this.states.fullScreen=!0,t.addClass(e,this.pre+"-fullscreen")):(this.share(),this.states.fullScreen=!1,t.removeClass(e,this.pre+"-fullscreen")),this.videoFullScreen()},u.requestFullScreen=function(){var t=this.browser.fullScreen.request;document.documentElement[t]&&this.DOM.holder[t]()},u.exitFullScreen=function(){var t=this.browser.fullScreen.exit;document[t]&&document[t]()},u.play=function(){this.states.play?this.stopSlideShow():this.startSlideShow()},u.startSlideShow=function(){var e=0,i=this.gallery,s=this.options,o=this.states.loop,n=s.slideShowAutoStop,r=Math.max(120,s.slideShowInterval),a=s.countTimer,h=a&&this.DOM.timer?this.DOM.timer.getContext("2d"):null,l=(function(t){if(t=t||+new Date,e=e||t,(!o||n)&&i.index===i.initialLength-1){this.stopSlideShow();return}if(a&&h){var d=Math.min(1,(t-e+r)/r-1);h.clearRect(0,0,48,48),this.timerProgress(h,s.countTimerBg,100),this.timerProgress(h,s.countTimerColor,360*d*(Math.PI/180))}t>=e+r&&(e=t,this.slideTo(this.slides.index+1,!0)),this.timer=requestAnimationFrame(l)}).bind(this);t.addClass(this.DOM.holder,this.pre+"-autoplay"),this.states.play=!0,this.timer=requestAnimationFrame(l)},u.stopSlideShow=function(){cancelAnimationFrame(this.timer),t.removeClass(this.DOM.holder,this.pre+"-autoplay"),this.states.play=!1},u.timerProgress=function(t,e,i){var s=1.5*Math.PI;t.strokeStyle=e,t.lineWidth=5,t.beginPath(),t.arc(24,24,18,s,s+i,!1),t.stroke()},u.appendVideo=function(){var e=this.getMedia();if("video"===e.type){if(t.addClass(e.dom,this.pre+"-loading"),t.removeClass(e.dom,this.pre+"-playing"),!e.video){if("html5"===e.format){e.video=t.createEl("video"),e.video.setAttribute("controls",""),e.video.setAttribute("autoplay","");for(var i=e.src.replace(/\s/g,"").split(","),s=0;s<i.length;s++){var o=document.createDocumentFragment(),n=t.createEl("source"),r=/^.+\.([^.]+)$/.exec(i[s]);r&&["mp4","webm","ogv"].indexOf(r[1])>-1&&(n.src=i[s],n.setAttribute("type","video/"+("ogv"===r[1]?"ogg":r[1])),o.appendChild(n)),e.video.appendChild(o)}}else e.format&&(e.video=t.createEl("iframe"),e.video.src=e.src,e.video.setAttribute("frameborder",0),e.video.setAttribute("allowfullscreen",""));e.video.setAttribute("width","100%"),e.video.setAttribute("height","100%")}e.dom.firstChild||(e.dom.appendChild(e.video),"html5"===e.format||(e.video.loaded=!1)),this.playVideo(e)}},u.onVideoLoaded=function(e){e.video.loaded=!0,t.removeClass(e.dom,this.pre+"-loading"),t.addClass(e.dom,this.pre+"-playing"),this.cloneVideo(e)},u.cloneVideo=function(e){if(this.states.loop&&"html5"===e.format)for(var i=this.gallery,s=i.length,o=i.initialLength,n=t.modulo(o,e.index),r=0;r<s;r++)t.modulo(o,i[r].index)===n&&i[r].index!==e.index&&(i[r].video=e.video)},u.videoFullScreen=function(){var t=this.getMedia(),e=this.states.fullScreen;"video"===t.type&&"html5"!==t.format&&t.video&&t.video[e?"removeAttribute":"setAttribute"]("allowfullscreen","")},u.playVideo=function(e){if(e.video.loaded){if(e.video.getClientRects(),t.removeClass(e.dom,this.pre+"-loading"),t.addClass(e.dom,this.pre+"-playing"),"html5"!==e.format){if(e.play){var i="object"==typeof e.play?JSON.stringify(e.play):String(e.play);e.video.contentWindow.postMessage(i,"*")}}else if(!e.video.error){if("function"==typeof MediaElementPlayer&&this.options.mediaelement){var s="VIDEO"===e.video.tagName?e.video:e.video.getElementsByTagName("video")[0];s.player&&s.player.setControlsSize(),s.play()}else e.video.play()}}else{var o=this;"function"!=typeof MediaElementPlayer||e.play||!this.options.mediaelement||e.video.player?e.video.onload||(e.video.onload=e.video.onerror=e.video.onloadedmetadata=function(){e.dom.firstChild&&(o.onVideoLoaded(e),o.videoFullScreen())},e.video.src=e.src.replace(/\s/g,"").split(",")[0]):new MediaElementPlayer(e.video,{features:["playpause","stop","current","progress","duration","volume","fullscreen"],videoVolume:"horizontal",startVolume:.8,classPrefix:"mejs-",keyActions:[],enableKeyboard:!1,iPadUseNativeControls:!0,iPhoneUseNativeControls:!0,AndroidUseNativeControls:!0,success:function(t){t.addEventListener("loadeddata",function(){if(e.video=e.dom.lastChild,e.video){var t=e.video.previousSibling;t&&t.parentNode&&t.parentNode.removeChild(t),o.onVideoLoaded(e)}},e,!1)},error:function(){o.onVideoLoaded(e)}})}},u.pauseVideo=function(){var e=this.getMedia();if(e&&"video"===e.type&&e.video){if(t.removeClass(e.dom,this.pre+"-playing"),!e.video.loaded){e.dom.innerHTML="",t.removeClass(e.dom,this.pre+"-loading");return}if("html5"===e.format)"function"==typeof MediaElementPlayer&&this.options.mediaelement?("VIDEO"===e.video.tagName?e.video:e.video.getElementsByTagName("video")[0]).pause():e.video.pause();else if(e.pause&&"dailymotion"!==e.format){var i="object"==typeof e.pause?JSON.stringify(e.pause):String(e.pause);e.video.contentWindow.postMessage(i,"*")}else e.dom.innerHTML="",e.video=null}},u.insertMedia=function(t,e){var i=this.gallery[t];i&&(void 0===i.index&&(i.index=this.gallery.indexOf(i)),this.buildMedia(i),this.appendMedia(i,e),this.loadMedia(i,e))},u.buildMedia=function(e){if(void 0===e.dom){switch(e.type){case"image":e.dom=t.createEl("img",this.pre+"-img"),e.dom.src=e.src;break;case"video":e.dom=t.createEl("div",this.pre+"-video"),e.poster?e.dom.style.backgroundImage='url("'+e.poster+'")':e.dom.loaded=!0;break;case"iframe":e.dom=t.createEl("iframe",this.pre+"-iframe"),e.dom.setAttribute("allowfullscreen",""),e.dom.setAttribute("frameborder",0),e.dom.src=e.src;break;case"HTML":var i=e.src,s=document.querySelector(i);e.dom=t.createEl("div",this.pre+"-html"),e.dom.appendChild(t.createEl("div",this.pre+"-html-inner")),e.dom.firstChild.innerHTML=s?s.innerHTML:null,e.src=s||"",e.dom.loaded=!0}e.type&&e.src||(e.dom=t.createEl("div",this.pre+"-error"),e.dom.textContent=this.options.noContent,e.dom.loaded=!0,e.dom.error=!0,t.dispatchEvent(this,"modulobox","noContent",this.gallery.name,parseInt(e.index,10)))}},u.appendMedia=function(e,i){var s,o=this.slides[i],n=o.firstChild;if(n.childElementCount){var r=n.lastChild;(s=n.firstChild).style.visibility="",e.dom!==r&&n[1===n.childElementCount?"appendChild":"replaceChild"](e.dom,r)}else{var a=document.createDocumentFragment();s=t.createEl("div",this.pre+"-loader"),a.appendChild(s),a.appendChild(e.dom),n.appendChild(a)}o.media=e.index},u.loadMedia=function(e,i){if(e.dom.loaded){this.showMedia(e,i);return}var s=this,o="iframe"===e.type?e.dom:e.dom.img=new Image,n=function(){e.dom.error||t.dispatchEvent(s,"modulobox","loadComplete",s.gallery.name,parseInt(e.index,10)),e.dom.loaded="iframe"!==e.type,s.showMedia(e,i)};o.onload=n,o.onerror=function(o){"video"!==e.type&&(e.dom=t.createEl("p",s.pre+"-error"),e.dom.textContent=s.options.loadError,e.dom.error=!0,s.appendMedia(e,i)),t.dispatchEvent(s,"modulobox","loadError",s.gallery.name,parseInt(e.index,10)),n()},o.src="video"===e.type?e.poster:e.src},u.unloadMedia=function(t){if(this.gallery){var e=t.media,i=this.gallery[e];i&&i.dom&&(!this.options.unload||"image"!==i.type||i.dom.loaded||i.dom.complete||i.dom.naturalWidth?"video"===i.type&&"html5"!==i.format&&i.dom.firstChild&&(i.video=null,i.dom.removeChild(i.dom.firstChild)):(i.dom.onload=null,i.dom.onerror=null,i.dom.src="",i.dom.img&&(i.dom.img.onload=null,i.dom.img.onerror=null,i.dom.img.src="",delete i.dom.img),delete i.dom))}},u.removeMedia=function(t){var e=t.firstChild;if(e)for(;e.firstChild;)e.removeChild(e.firstChild)},u.showMedia=function(e,i){var s=this.slider;if(!this.options.fadeIfSettle||s.settle||e.dom.revealed){var o=this.slides[i],n=this.gallery,r=o.firstChild.firstChild,a=this.options.preload;this.setMediaSize(e,o),e.index===n.index&&this.isZoomable(),t.addClass(e.dom,this.pre+"-media-loaded"),e.dom.revealed=!0,o.media===e.index&&(r.style.visibility="hidden",n.loaded+=1,n.loaded===a&&a<4&&this.setMedia(a+2)),"iframe"===e.type&&(e.dom.loaded=!1)}},u.setMediaSize=function(t,e){var i=t.dom,s=this.slider,o=i.viewport,n=this.getThumbHeight();if(!i.error){o&&o.width===s.width&&o.height===s.height-n||(this.getCaptionHeight(t,e),this.getMediaSize(t,e),this.fitMediaSize(t,e),this.setMediaOffset(t,e));var r=i.style;r.width=i.size.width+"px",r.height=i.size.height+"px",r.left=i.offset.left+"px",r.top=i.offset.top+"px"}},u.getCaptionHeight=function(t,e){var i=this.DOM.captionInner,s=this.DOM.topBar.height,o=i.innerHTML,n=this.getThumbHeight();this.options.caption&&this.states.caption&&t.caption?(i.innerHTML=t.caption,i.height=Math.max(s,parseInt(i.clientHeight,10))||s,i.innerHTML=o):i.height=n?0:s,e.width=this.slider.width,e.height=this.slider.height-s-i.height-n},u.getMediaSize=function(t,e){var i=t.dom.size={};switch(t.type){case"image":i.width=t.dom.naturalWidth,i.height=t.dom.naturalHeight;break;case"video":i.width=this.options.videoMaxWidth,i.height=i.width/this.options.videoRatio;break;case"iframe":i.width=t.width?t.width:e.width>680?.8*e.width:e.width,i.height=t.height?t.height:e.height;break;case"HTML":i.width=t.width?t.width:e.width,i.height=t.height?t.height:e.height}},u.fitMediaSize=function(t,e){var i,s,o=this.slider,n=this.options,r=n.zoomTo,a=t.dom.size,h=a.width/a.height,l=this.getThumbHeight(),d=o.width<=480||o.height<=680,u=0>["video","iframe","HTML"].indexOf(t.type),p=n.smartResize&&d,m=[e.height];(p||n.overflow)&&u&&m.unshift(o.height-l),m.forEach(function(t){(!s||s<o.height-l)&&(i=(i=Math.min(a.width,h*t))>e.width?e.width:Math.round(i),s=(s=Math.ceil(1/h*i))%t<2?t:s)});var c=Number((a.width/i).toFixed(3));r="auto"===r?c:r,t.dom.size={width:i,height:s,scale:c>=n.minZoom?Math.min(n.maxZoom,r):1}},u.setMediaOffset=function(t,e){var i=t.dom.size,s=this.slider,o=this.DOM.topBar.height,n=this.getThumbHeight(),r=0;i.height<=e.height&&(r=o+(e.height-i.height)*.5),t.dom.offset={top:r<0?0:Math.round(r),left:Math.round((e.width-i.width)*.5)},t.dom.viewport={width:s.width,height:s.height-n}},u.mediaViewport=function(t){var e=this.getMedia();if(!e.dom||!e.dom.size)return{top:0,bottom:0,left:0,right:0};var i=e.dom.size,s=e.dom.offset,o=this.slider.height,n=this.slider.width,r=(o-i.height)*.5,a=2*s.top-r,h=(r-a)*.5,l=h*t-2*h-a,d=i.width/2*(t-1)-s.left,u=i.height*t<=o?h*t:-i.height/2*(t-1)+o-i.height+l,p=i.height*t<=o?h*t:i.height/2*(t-1)+l;return{top:t<=1?0:Math.round(u),bottom:t<=1?0:Math.round(p),left:i.width*t<n?0:Math.round(d),right:i.width*t<n?0:Math.round(-d)}},u.setMedia=function(e){var i,s=this.gallery,o=this.slides,n=this.states.loop,r=Math.round(-this.isRTL()*this.slider.position.x/o.width),a=s.initialLength-1,h=0,l=[];if(!e&&!s.loaded){for(i=0,e=0;i<o.length;i++)o[i].firstChild.childElementCount&&e++;e+=2,s.loaded=this.options.preload}switch(e){case 0:case 1:l=[0];break;case 2:case 3:l=[-1,0,1];break;default:e=5,l=[-2,-1,0,1,2]}if(!n){var d=r+l[e-1],u=r+l[0];h=u<0?-u:0,h=d>a?a-d:h}for(i=0,l=l.map(function(e){return t.modulo(s.length,e+h+r)});i<o.length;i++){var p=o[i],m=t.modulo(s.length,p.index);(n||!(p.index>m))&&l.indexOf(m)>-1&&p.media!==m&&(this.unloadMedia(p),this.insertMedia(m,i))}},u.updateMediaInfo=function(){var e=this.slides,i=this.gallery;i.index=t.modulo(i.length,e.index),this.isZoomable(),this.isDownloadable(),this.updateCounter(),this.updateCaption(),this.updateThumbs(),t.dispatchEvent(this,"modulobox","updateMedia",this.getMedia())},u.setThumbs=function(){var e=this.gallery,i=this.thumbs,s=e.initialLength,o=this.options.thumbnails,n=this.DOM.thumbsHolder;if(!o||s<2){this.DOM.caption.style.bottom=0,n.style.visibility="hidden",n.style.height=0,i.height=i.gutter=0;return}var r,a=this.options.thumbnailSizes,h=Math.max(window.innerWidth,Math.max(screen.width,screen.height)),l=0,d=Object.keys(a).sort(function(t,e){return t-e});for(r=0;r<d.length;r++){var u=d[r],p=Math.ceil((r===d.length-1?h:Math.min(h,u))/(a[u].width+a[u].gutter)*2);if(isFinite(p)&&p>l&&(l=p),u>=h)break}var m=document.createDocumentFragment();for(r=0,s=s>50?Math.min(l,s):s;r<s;r++){var c=t.createEl("div",this.pre+"-thumb");m.appendChild(c)}this.DOM.thumbsInner.appendChild(m),this.setThumbsPosition()},u.thumbClick=function(e){var i=e.target;t.hasClass(i,this.pre+"-thumb")||(i=i.parentNode),parseInt(i.index,10)>=0&&this.slideTo(i.index)},u.loadThumb=function(e,i){var s,o=this.gallery[i];if(o.thumb&&"object"==typeof o.thumb||(s=o.thumb,o.thumb=t.createEl("div",this.pre+"-thumb-bg"),o.thumb.style.backgroundImage=s&&0>s.indexOf(".json")?"url("+s+")":null,"video"===o.type&&(t.addClass(o.thumb,this.pre+"-thumb-video"),t.addClass(o.thumb,this.pre+"-thumb-loaded"))),e[e.firstChild?"replaceChild":"appendChild"](o.thumb,e.firstChild),e.media=i,s){var n=new Image;n.onload=(function(){t.addClass(o.thumb,this.pre+"-thumb-loaded")}).bind(this),n.src=s}},u.updateThumbs=function(){var e=this.gallery;if(this.options.thumbnails&&!(e.initialLength<2)){var i=this.thumbs,s=this.getThumbPosition(i);if(i.stopAnimate(),s===i.position.x){this.shiftThumbs(i);return}Math.abs(s-i.position.x)>50*i.size?(this.DOM.thumbsHolder.style.visibility="hidden",i.position.x=s,t.translate(this.DOM.thumbsInner,s,0),this.renderThumbs(i),this.DOM.thumbsHolder.style.visibility=""):(i.startAnimate(),i.releaseDrag(),i.animateTo({x:s}))}},u.updateCaption=function(){if(this.options.caption){var t=this.getMedia(),e=t.caption?t.caption:"",i=this.DOM.captionInner;i.innerHTML!==e&&(i.innerHTML=e)}},u.updateCounter=function(){if(this.options.counterMessage){var e=this.gallery,i=e.initialLength,s=t.modulo(i,e.index),o=this.options.counterMessage.replace("[index]",s+1).replace("[total]",i),n=this.DOM.counter;n.textContent!==o&&(n.textContent=o)}},u.wrapAround=function(){var e=this.options.loop,i=this.gallery,s=i.length;if(i.initialLength||(i.initialLength=s),this.states.loop=!!e&&e<=s,this.states.loop&&s<this.slides.length)for(var o=Math.ceil(this.slides.length/s)*s-s,n=0;n<o;n++){var r=s+n;i[r]=t.cloneObject(i[t.modulo(s,n)]),i[r].index=r}},u.setSlider=function(){var t=this.slider,e=this.slides;this.setSizes(t,e),this.setSliderPosition(t,e),this.setSlidesPositions(e),this.DOM.overlay.style.opacity=1},u.setSizes=function(t,e){t.width=document.body.clientWidth,t.height=window.innerHeight,e.width=t.width+Math.round(t.width*this.options.spacing)},u.setSlidesPositions=function(t){for(var e=0;e<t.length;e++)t[e].position=null,this.setCellPosition(e);this.shiftSlides()},u.setThumbsPosition=function(){if(this.options.thumbnails&&!(this.gallery.initialLength<2)){for(var e,i=this.thumbs,s=this.slider,o=this.DOM.thumbsHolder,n=this.DOM.thumbsInner,r=this.options.thumbnailSizes,a=this.options.rightToLeft,h=Object.keys(r).sort(function(t,e){return e-t}),l=Math.max.apply(null,h),d=window.innerWidth,u=0;u<h.length;u++)d<=(e=Number(h[u]))&&(l=e);i.width=Number(r[l].width),i.gutter=Number(r[l].gutter),i.height=Number(r[l].height),i.size=i.width+i.gutter,i.length=this.gallery.initialLength;var p=i.length*i.size;i.bound={left:0,right:p>s.width?s.width-p:0},a&&(i.bound.right=p>s.width?s.width-i.size:p-i.size,i.bound.left=p-i.size),"centered"===this.options.thumbnailsNav&&(i.bound={left:p>s.width?Math.floor(.5*s.width-.5*i.size):Math.floor(.5*p-.5*i.size),right:p>s.width?Math.ceil(.5*s.width-p+.5*i.size):-Math.ceil(.5*p-.5*i.size)},a&&(i.bound.right=i.bound.left,i.bound.left=i.bound.left+p-i.size)),i.resetAnimate();var m=this.getThumbPosition(i);i.position.x=m,t.translate(n,m,0);var c=this.getThumbHeight();o.style.visibility=c?"":"hidden",o.style.height=c?c+"px":"",n.style.height=c?i.height+Math.min(10,i.gutter)+"px":"",n.style.width=i.length*i.size+"px",n.style.right=p>s.width&&a?"auto":""}},u.getThumbPosition=function(e){var i=this.slider,s=this.gallery,o=this.options.thumbnailsNav,n=this.isRTL(),r=n<0?"right":"left",a=t.modulo(s.initialLength,s.index),h=.5*i.width-.5*e.size,l=e.bound[r]-a*e.size*n;return l=e.bound[r]?l+(n<0&&"centered"!==o?-h:0):l+h,Math.max(e.bound.right,Math.min(e.bound.left,l))},u.setCellPosition=function(e){this.cells[e].resetAnimate(),t.translate(this.slides[e].children[0],0,0,1)},u.setSliderPosition=function(e,i){var s=this.options.rightToLeft,o=-i.index*i.width;o=s?-o:o,e.resetAnimate(),e.position.x=e.attraction.x=o,e.bound={left:0,right:-(this.gallery.length-1)*i.width},s&&(e.bound.left=-e.bound.right,e.bound.right=0),t.translate(this.DOM.slider,o,0)},u.setAnimation=function(){var t=this.DOM.slider,e=this.options.friction,s=this.options.attraction;this.slider=new i(t,{x:0,y:0},Math.min(Math.max(e.slider,0),1),Math.min(Math.max(s.slider,0),1)),this.slider.on("settle.toanimate",this.settleSider.bind(this)),this.slider.on("render.toanimate",this.renderSlider.bind(this));for(var o=t.children,n=o.length,r=0;r<n;r++)this.cells[r]=new i(o[r].children[0],{x:0,y:0,s:1},Math.min(Math.max(e.slide,0),1),Math.min(Math.max(s.slide,0),1)),this.cells[r].on("settle.toanimate",this.settleCell.bind(this)),this.cells[r].on("render.toanimate",this.renderCell.bind(this));this.thumbs=new i(this.DOM.thumbsInner,{x:0},Math.min(Math.max(e.thumbs,0),1),Math.min(Math.max(s.thumbs,0),1)),this.thumbs.on("settle.toanimate",this.settleThumbs.bind(this)),this.thumbs.on("render.toanimate",this.renderThumbs.bind(this))},u.settleSider=function(e){var i;if(t.dispatchEvent(this,"modulobox","sliderSettled",e.position),this.states.open&&(this.setMedia(),this.replaceState()),this.options.fadeIfSettle)for(var s=this.slides,o=0;o<s.length;o++){var n=s[o].media;(i=this.gallery[n]).dom.loaded&&this.showMedia(i,o)}},u.settleCell=function(e){var i=this.gesture;i.closeBy&&t.dispatchEvent(this,"modulobox","panYSettled",null,e.position),(i.closeBy&&!1===i.canClose||!i.closeBy)&&t.dispatchEvent(this,"modulobox","panZoomSettled",null,e.position)},u.settleThumbs=function(e){t.dispatchEvent(this,"modulobox","thumbsSettled",null,e.position)},u.renderSlider=function(e){this.shiftSlides();var i=this.isRTL(),s=this.gallery.initialLength,o=-i*e.position.x/this.slides.width,n=t.modulo(s,o);t.dispatchEvent(this,"modulobox","sliderProgress",null,Math.min(1,Math.max(0,(n>s-.5?0:n)/(s-1))))},u.renderCell=function(e){var i;this.willClose(e),("panY"===this.gesture.type||this.gesture.closeBy||"dragSlider"===this.gesture.type&&0!==e.position.y)&&(i=1-Math.abs(e.position.y)/(.5*this.slider.height),t.dispatchEvent(this,"modulobox","panYProgress",null,i)),"panY"!==this.gesture.type&&1!==e.position.s&&(i=e.position.s,t.dispatchEvent(this,"modulobox","panZoomProgress",null,i))},u.renderThumbs=function(e){this.shiftThumbs(e);var i=e.bound.left!==e.bound.right?(e.bound.left-e.position.x)/(e.bound.left-e.bound.right):0;t.dispatchEvent(this,"modulobox","thumbsProgress",null,i)},u.touchStart=function(e){var i=e.target,s=i.tagName,o=i.className;if(3!==e.which&&i!==this.buttons.play&&this.stopSlideShow(),!(3===e.which||!this.isEl(e)||["BUTTON","VIDEO","INPUT","A"].indexOf(s)>-1)){if("IMG"===s&&this.gallery.length>1&&t.addClass(this.DOM.holder,this.pre+"-dragging"),e.preventDefault(),!t.hasClass(this.DOM.holder,this.pre+"-open-tooltip")){if(this.pointers.length||(this.gesture.canClose=void 0,t.handleEvents(this,window,this.dragEvents.move,"touchMove"),t.handleEvents(this,window,this.dragEvents.end,"touchEnd")),this.addPointer(e),0>o.indexOf("-thumb")){this.slider.stopAnimate();var n=this.getCell();(Math.round(100*n.position.s)/100!=1||2===this.pointers.length||this.gesture.closeBy)&&n.stopAnimate()}else this.thumbs.stopAnimate();this.gestures("start")}}},u.touchMove=function(e){this.updatePointer(e);var i=this.gesture,s=this.pointers.length,o=this.isSliderSettle();if(this.switchPointers(),this.gestures("move"),i.type)this[i.type](e),t.dispatchEvent(this,"modulobox",i.type+"Move",e,i),i.move=!0;else if(2===s&&o||Math.abs(i.dx)>this.options.threshold||Math.abs(i.dy)>this.options.threshold){if(i.sx+=i.dx,i.sy+=i.dy,i.canZoom=this.isZoomable(),i.closeBy=!1,i.type=!(Math.abs(i.dx)<Math.abs(i.dy)/2)&&"dragSlider",i.type=this.options.dragToClose&&!i.type&&o?"panY":i.type,i.type=(this.options.pinchToZoom||this.states.zoom)&&i.canZoom&&o&&(2===s||this.states.zoom)?"panZoom":i.type,i.type=this.options.pinchToClose&&i.scale<1&&o&&2===s?"panZoom":i.type,i.type=e.target.className.indexOf("-thumb")>-1?"dragThumbs":i.type,"dragSlider"===i.type&&this.setMedia(),["dragSlider","dragThumbs"].indexOf(i.type)>-1){var n=this.getCell();n.startAnimate(),n.releaseDrag(),n.animateTo({x:0,y:0,s:1})}if("dragSlider"!==i.type){var r=this.slider,a=this.slides;-this.isRTL()*r.position.x!=a.index*a.width&&(r.startAnimate(),r.releaseDrag())}i.type&&(this.pauseVideo(),t.dispatchEvent(this,"modulobox",i.type+"Start",e,i),(this.gallery.length>1||"dragSlider"!==i.type)&&t.addClass(this.DOM.holder,this.pre+"-dragging"))}},u.touchEnd=function(e){if(this.deletePointer(e),!this.pointers.length){if(t.removeClass(this.DOM.holder,this.pre+"-dragging"),t.handleEvents(this,window,this.dragEvents.move,"touchMove",!1),t.handleEvents(this,window,this.dragEvents.end,"touchEnd",!1),this.isSliderSettle()){var i=e.target.className;if(t.hasClass(e.target,this.pre+"-video"))this.appendVideo();else if(this.options.tapToClose&&!this.states.zoom&&(i===this.pre+"-item-inner"||i===this.pre+"-top-bar")&&Math.abs(this.gesture.dx)<this.options.threshold){this.close();return}"IMG"===e.target.tagName&&this.doubleTap(e)}this.options.thumbnails&&!this.gesture.move&&this.thumbClick(e);var s=this.gesture.type+"End";if(this.gesture.type&&"function"==typeof this[s]&&(this[s](e),t.dispatchEvent(this,"modulobox",s,e,this.gesture)),this.gesture.type=this.gesture.move=!1,this.states.open){var o=this.getCell();o.settle||(o.startAnimate(),o.releaseDrag());var n=this.slider;n.settle||(n.startAnimate(),n.releaseDrag())}}},u.switchPointers=function(){if("panZoom"===this.gesture.type&&1===this.pointers.length&&0!==this.gesture.distance){var t=this.getCell();t.stopAnimate(),t.startAnimate(),this.gesture.move=!1,this.gestures("start"),this.gestures("move")}},u.doubleTap=function(e){e.preventDefault();var i=this.mapPointer(e),s=i[0].clientX,o=i[0].clientY;void 0!==this.tap&&+new Date-this.tap.delay<350&&30>Math.abs(this.tap.deltaX-s)&&30>Math.abs(this.tap.deltaY-o)?(this.states.tapIdle&&clearTimeout(this.states.tapIdle),this.options.doubleTapToZoom&&this.zoomTo(s,o),this.tap=void 0):(this.browser.touchDevice&&this.options.timeToIdle&&!this.states.idle&&(this.states.tapIdle=setTimeout((function(){t[(t.hasClass(this.DOM.holder,this.pre+"-idle")?"remove":"add")+"Class"](this.DOM.holder,this.pre+"-idle")}).bind(this),350)),this.tap={delay:+new Date,deltaX:i[0].clientX,deltaY:i[0].clientY})},u.isSliderSettle=function(){if(this.gesture.type)return!1;var t=this.isRTL(),e=this.slides,i=e.width;return Math.abs(t*this.slider.position.x+e.index*i)/i*100<=3},u.mapPointer=function(t){return t.touches?t.changedTouches:[t]},u.addPointer=function(t){for(var e=this.mapPointer(t),i=0;i<e.length;i++)if(this.pointers.length<2&&-1===["dragSlider","panY","dragThumbs"].indexOf(this.gesture.type)){var s=e[i],o=void 0!==s.pointerId?s.pointerId:s.identifier;this.getPointer(o)||(this.pointers[this.pointers.length]={id:o,x:Math.round(s.clientX),y:Math.round(s.clientY)})}},u.updatePointer=function(t){for(var e=this.mapPointer(t),i=0;i<e.length;i++){var s=e[i],o=void 0!==s.pointerId?s.pointerId:s.identifier,n=this.getPointer(o);n&&(n.x=Math.round(s.clientX),n.y=Math.round(s.clientY))}},u.deletePointer=function(t){for(var e=this.mapPointer(t),i=0;i<e.length;i++)for(var s=e[i],o=void 0!==s.pointerId?s.pointerId:s.identifier,n=0;n<this.pointers.length;n++)this.pointers[n].id===o&&this.pointers.splice(n,1)},u.getPointer=function(t){for(var e in this.pointers)if(this.pointers[e].id===t)return this.pointers[e];return null},u.gestures=function(t){var e,i=this.gesture,s=this.pointers;if(s.length){if(i.direction=i.x?s[0].x>i.x?1:-1:0,i.x=s[0].x,i.y=s[0].y,2===s.length){var o=s[1].x,n=s[1].y;e=this.getDistance([i.x,i.y],[o,n]),i.x=i.x-(i.x-o)/2,i.y=i.y-(i.y-n)/2}"start"===t?(i.dx=0,i.dy=0,i.sx=i.x,i.sy=i.y,i.distance=e||0):(i.dx=i.x-i.sx,i.dy=i.y-i.sy,i.scale=e&&i.distance?e/i.distance:1)}},u.getDistance=function(t,e){var i=e[0]-t[0],s=e[1]-t[1];return Math.sqrt(i*i+s*s)},u.panY=function(){var t=this.getCell();t.startAnimate(),t.updateDrag({x:t.position.x,y:t.start.y+this.gesture.dy,s:t.position.s})},u.panYEnd=function(){var t=0,e=this.getCell(),i=this.slider.height,s=e.resting.y;1-Math.abs(s)/(.5*i)<.8&&(t=Math.abs(s)<.5*i?Math.abs(s)/s*i*.5:s,this.close(),e.animateTo({x:0,y:t,s:t?e.resting.s:1}),e.startAnimate(),e.releaseDrag())},u.panZoom=function(){var t=this.getCell(),e=this.gesture,i=this.mediaViewport(t.position.s),s=this.options.pinchToClose&&e.canClose?.1:.6,o=Math.min(1.5*this.options.maxZoom,Math.max(s,t.start.s*e.scale)),n=t.start.x+e.dx,r=t.start.y+e.dy,a=e.sx-.5*this.slider.width,h=e.sy-.5*this.slider.height;e.canZoom&&(this.options.pinchToZoom||this.states.zoom)||(o=Math.min(1,o)),!this.options.pinchToZoom&&this.states.zoom&&(o=t.position.s),e.move||1!==this.pointers.length||(t.start.x+=n>i.left?n-i.left:n<i.right?n-i.right:0,t.start.y+=r>i.bottom?r-i.bottom:r<i.top?r-i.top:0),n=e.dx+a+(t.start.x-a)*(o/t.start.s),r=e.dy+h+(t.start.y-h)*(o/t.start.s),1===this.pointers.length&&(n=n>i.left?(n+i.left)*.5:n<i.right?(n+i.right)*.5:n,r=r>i.bottom?(r+i.bottom)*.5:r<i.top?(r+i.top)*.5:r),t.startAnimate(),t.updateDrag({x:n,y:r,s:o}),this.updateZoom(o)},u.panZoomEnd=function(){var t,e,i=this.getCell(),s=this.gesture,o=i.resting.s>this.options.maxZoom?this.options.maxZoom:i.resting.s<1?1:i.resting.s,n=this.mediaViewport(o);if(Math.round(10*i.resting.s)/10>this.options.maxZoom){var r=s.distance?s.sx-.5*this.slider.width:0,a=s.distance?s.sy-.5*this.slider.height:0;t=s.dx+r+(i.start.x-r)*(o/i.start.s),e=s.dy+a+(i.start.y-a)*(o/i.start.s),t=t>n.left?n.left:t<n.right?n.right:t,e=e>n.bottom?n.bottom:e<n.top?n.top:e}else t=i.resting.x>n.left?n.left:i.resting.x<n.right?n.right:void 0,e=i.resting.y>n.bottom?n.bottom:i.resting.y<n.top?n.top:void 0;this.options.pinchToClose&&i.resting.s<.8&&s.canClose&&(o=i.resting.s<.3?i.resting.s:.15,t=i.resting.x,e=i.resting.y,this.close()),i.animateTo({x:t,y:e,s:o!==i.resting.s?o:void 0}),i.startAnimate(),i.releaseDrag(),this.updateZoom(i.resting.s)},u.dragThumbs=function(){var t=this.thumbs,e=t.bound,i=t.start.x+this.gesture.dx;this.gesture.move||(t.start.x+=i>e.left?i-e.left:i<e.right?i-e.right:0,i=t.start.x+this.gesture.dx),i=i>e.left?(i+e.left)*.5:i<e.right?(i+e.right)*.5:i,t.startAnimate(),t.attraction.x=void 0,t.updateDrag({x:i})},u.dragThumbsEnd=function(){var t=this.thumbs,e=t.bound,i=t.resting.x;(i=i>e.left?e.left:i<e.right?e.right:i)!==t.resting.x&&t.animateTo({x:i}),t.startAnimate(),t.releaseDrag()},u.dragSlider=function(){if(1!==this.gallery.length){var t=this.slider,e=t.start.x+this.gesture.dx;if(!this.states.loop){var i=t.bound;this.gesture.move||(t.start.x+=e>i.left?e-i.left:e<i.right?e-i.right:0,e=t.start.x+this.gesture.dx),e=e>i.left?(e+i.left)*.5:e<i.right?(e+i.right)*.5:e}t.startAnimate(),t.updateDrag({x:e})}},u.dragSliderEnd=function(){if(1!==this.gallery.length){var t=this.slider,e=this.slides,i=e.index,s=this.isRTL(),o=t.resting.x,n=t.position.x;this.getRestingIndex(n,o),i!==e.index&&this.updateMediaInfo(),this.slider.animateTo({x:-s*e.index*e.width,y:void 0,s:void 0}),t.startAnimate(),t.releaseDrag()}},u.getRestingIndex=function(t,e){var i=this.gesture.direction,s=this.gallery,o=this.slides,n=this.gesture.dx,r=this.isRTL(),a=Math.round(-r*t/o.width);Math.abs(n)<.5*o.width&&Math.abs(e-t)&&(n>0&&i>0?a-=1*r:n<0&&i<0&&(a+=1*r));var h=Math.max(-1,Math.min(1,a-o.index));(this.states.loop||!(s.index+h<0)&&!(s.index+h>s.length-1))&&(o.index+=h)},u.shiftSlides=function(){var e=this.slides,i=this.gallery,s=this.states.loop,o=this.isRTL(),n=o*Math.round(-this.slider.position.x/e.width)-2,r=n+5;!s&&r>i.initialLength-1&&(r=(n=i.initialLength-5)+5),!s&&n<0&&(n=0,r=5);for(var a=n;a<r;a++){var h=o*a*e.width,l=e[t.modulo(e.length,a)];(l.index!==a||l.position!==h)&&(l.index=a,l.position=h,l.style.left=h+"px")}this.states.open&&this.setMedia(3)},u.shiftThumbs=function(e){var i=this.DOM.thumbsInner.children,s=this.slider,o=this.gallery,n=this.isRTL(),r=i.length,a=t.modulo(o.initialLength,o.index),h=e.size*r*.5,l=Math.max(0,Math.round((-n*e.position.x+n*h*.5)/e.size)-Math.floor(r/2)),d=l+r,u=.5*s.width,p=e.position.x+u,m=e.position.x-s.width-u;d>o.initialLength&&(l=(d=o.initialLength)-r),d===o.initialLength-1&&l-d<r&&(l=o.initialLength-r);for(var c=l;c<d;c++){var g=i[t.modulo(r,c)],f=n*c*e.size+.5*e.gutter,v=this.pre+"-active-thumb",b=t.hasClass(g,v);(g.index!==c||g.position!==f)&&(g.index=c,g.position=f,g.style.left=f+"px"),this.setThumbSize(g,e),-g.position<=p&&-g.position>=m&&g.media!==c&&this.loadThumb(g,c),b&&a!==c?t.removeClass(g,v):b||a!==c||t.addClass(g,v)}},u.setThumbSize=function(t,e){(t.width!==e.width||t.height!==e.height||t.gutter!==e.gutter)&&(t.width=e.width,t.height=e.height,t.gutter=e.gutter,t.style.width=e.width+"px",t.style.height=e.height+"px")},u.willClose=function(e){var i=this.DOM.overlay.style.opacity,s=this.gesture.canClose,o=this.gesture.type,n=this.gesture.closeBy;e.position.s>1.1&&void 0===s?this.gesture.canClose=!1:e.position.s<1&&void 0===s&&(this.gesture.canClose=!0),this.options.pinchToClose&&("panZoom"===o||"panZoom"===n)&&this.gesture.canClose?(i=e.position.s,this.gesture.closeBy="panZoom"):"panY"===o||"panY"===n?(i=1-Math.abs(e.position.y)/(.5*this.slider.height),this.gesture.closeBy="panY"):i&&i<1&&(i=1,this.gesture.closeBy=!1),t[((i=i?Math.max(0,Math.min(1,i)):1)<=.8||!i?"add":"remove")+"Class"](this.DOM.holder,this.pre+"-will-close"),this.DOM.overlay.style.opacity=i},u.prev=t.throttle(function(){this.gesture.move||this.slideTo(this.slides.index-1*this.isRTL())},120),u.next=t.throttle(function(){this.gesture.move||this.slideTo(this.slides.index+1*this.isRTL())},120),u.slideTo=function(e,i){var s=this.slides,o=this.gallery,n=this.DOM.slider,r=this.isRTL(),a=o.initialLength,h=t.modulo(a,e),l=t.modulo(a,o.index),d=h-l,u=a-Math.abs(d);if(this.states.loop||!(e<0)&&!(e>this.gallery.initialLength-1)){if(this.states.loop&&u<3&&2*u<a&&(d=d<0?u:-u),h===e&&(e=s.index+d),d=e-s.index){this.states.zoom&&this.zoom(),this.pauseVideo(),this.share(),i||this.stopSlideShow(),s.index=e;var p=this.slider;if(Math.abs(d)>2){t.addClass(n,this.pre+"-hide"),this.setSliderPosition(p,s),this.setSlidesPositions(s);var m=r*s.width*Math.min(2,Math.abs(d))*Math.abs(d)/d;p.position.x=p.attraction.x=p.position.x+m,t.translate(n,p.position.x,0),n.getClientRects()}this.updateMediaInfo(),t.removeClass(n,this.pre+"-hide"),p.startAnimate(),p.releaseDrag(),p.animateTo({x:-r*e*s.width,y:0,s:void 0})}}},u.keyDown=function(t){var e=t.keyCode,i=this.options;if(i.prevNextKey&&(37===e?this.prev(t):39===e&&this.next(t)),27===e&&i.escapeToClose&&this.close(),!i.mouseWheel&&[32,33,34,35,36,38,40].indexOf(e)>-1)return t.preventDefault(),!1},u.zoom=function(){this.zoomTo()},u.zoomTo=function(t,e,i){if(this.isSliderSettle()&&(this.isZoomable()||!(i>1))){this.gesture.closeBy=!1;var s=this.getMedia();i=i||(this.states.zoom?1:s.dom.size.scale);var o=this.getCell(),n=this.mediaViewport(i),r=t?t-.5*this.slider.width:0,a=e?e-.5*this.slider.height:0,h=i>1?Math.ceil(r+(o.position.x-r)*(i/o.position.s)):0,l=i>1?Math.ceil(a+(o.position.y-a)*(i/o.position.s)):0;o.startAnimate(),o.releaseDrag(),o.animateTo({x:h>n.left?n.left:h<n.right?n.right:h,y:l>n.bottom?n.bottom:l<n.top?n.top:l,s:i}),this.updateZoom(i)}},u.updateZoom=function(e){this.states.zoom=e>1,t[this.states.zoom?"addClass":"removeClass"](this.DOM.holder,this.pre+"-panzoom")},u.destroy=function(){if(this.GUID){this.states.open&&this.close();var t=this.options.mediaSelector,e="";try{e=document.querySelectorAll(t)}catch(i){}for(var s=0,o=e.length;s<o;s++){var n=e[s];n.mobxListener&&n.removeEventListener("click",n.mobxListener,!1)}for(this.bindEvents(!1),this.slider.resetAnimate(),s=0;s<this.slides.length;s++)this.cells[s].resetAnimate();this.thumbs&&this.thumbs.resetAnimate(),this.DOM.holder.parentNode.removeChild(this.DOM.holder),this.DOM.comment.parentNode.removeChild(this.DOM.comment),delete r[this.GUID],delete this.DOM.holder.GUID,delete this.GUID}},"undefined"!=typeof jQuery&&((s=jQuery).ModuloBox=function(t){return new d(t)}),d});